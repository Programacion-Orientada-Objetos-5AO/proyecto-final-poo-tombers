<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/styles/style.css">
    <title>TomberS - Interesados</title>
</head>
<body class="page-view" data-project-id="{{ project_id }}" data-project-title="{{ project_title or '' }}">
    <div class="logo-container">
        <img src="/static/imagenes/logoTomberS.png" alt="Logo Tomber Sur" class="logo-img">
    </div>

    <div class="sidebar" id="sidebar">
        <div class="menu-icons">
            <div class="menu-icon hamburger"></div>
            <a href="{{ url_for('feed') }}" class="menu-icon house" title="Descubrir proyectos"></a>
            <a href="{{ url_for('my_projects') }}" class="menu-icon layers" title="Mis proyectos"></a>
            <a href="{{ url_for('bio') }}" class="menu-icon user" title="Mi perfil"></a>
            <div class="menu-icon download"></div>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
    </div>
    <div class="sidebar-trigger" id="sidebar-trigger"></div>

    <div class="mobile-header" id="mobile-header">
        <img src="/static/imagenes/logoTomberS.png" alt="Logo Tomber Sur" class="logo-img-mini">
        <div class="menu-icons">
            <a href="{{ url_for('feed') }}" class="menu-icon house" title="Descubrir proyectos"></a>
            <a href="{{ url_for('my_projects') }}" class="menu-icon layers" title="Mis proyectos"></a>
            <a href="{{ url_for('bio') }}" class="menu-icon user" title="Mi perfil"></a>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="theme-togglemo">
            <span class="slider"></span>
        </label>
    </div>

    <main class="my-projects-layout" role="main">
        <section class="view-intro hero-block" aria-labelledby="hero-heading">
            <span class="hero-eyebrow">Gestión de talento</span>
            <h1 id="hero-heading">Personas interesadas</h1>
            <p class="hero-description">Evalúa cada postulación y responde rápido para mantener el entusiasmo del equipo.</p>

            <div class="hero-summary" aria-label="Resumen de postulaciones">
                <div class="hero-summary__item">
                    <span class="hero-summary__label">Totales</span>
                    <span class="hero-summary__value" id="hero-total-interested">0</span>
                </div>
                <div class="hero-summary__item">
                    <span class="hero-summary__label">Disponibles</span>
                    <span class="hero-summary__value" id="hero-available-interested">0</span>
                </div>
                <div class="hero-summary__item">
                    <span class="hero-summary__label">Aceptados</span>
                    <span class="hero-summary__value" id="hero-accepted-interested">0</span>
                </div>
            </div>

            <div class="hero-actions">
                <a href="{{ url_for('my_projects') }}" class="hero-button secondary">Volver a mis proyectos</a>
                <button type="button" class="hero-button primary" id="hero-open-profile">Abrir perfil destacado</button>
            </div>
        </section>

        <div class="card-container">
            <div class="project-card" id="project-card">
                <div class="card-title-row">
                    <h2 class="card-title">No hay personas cargadas</h2>
                </div>
                <div class="card-image interested-card-image"></div>
                <div class="card-stats">
                    <span><span class="fluent--people-team-16-filled iconos"></span><span class="stats-text">Rol</span></span>
                    <span><span class="tabler--clock iconos"></span><span class="stats-text">Disponibilidad</span></span>
                    <span><span class="material-symbols--translate iconos"></span><span class="stats-text">Idiomas</span></span>
                    <span><span class="mdi--tools iconos"></span><span class="stats-text">Especialidad</span></span>
                </div>
                <div class="card-description">
                    Cuando una persona de la comunidad se interese por tu proyecto vas a poder evaluarla desde esta vista y decidir si la sumás al equipo.
                </div>
                <div class="card-tech interested-tech">
                    <div class="tech-icon">UX</div>
                    <div class="tech-icon">API</div>
                    <div class="tech-icon">QA</div>
                    <div class="tech-icon">PM</div>
                </div>
            </div>
        </div>

        <div class="status-indicators" id="status-indicators">
            <div class="dislike-indicator">Rechazar</div>
            <div class="ampliar-indicator">Ver perfil</div>
            <div class="like-indicator">Aceptar</div>
        </div>
    </main>

    <div class="expanded-card hidden" id="expanded-card">
        <button class="close-expanded" id="close-expanded">&times;</button>
        <div class="expanded-content">
            <div class="expanded-header">
                <h2 class="expanded-title">Nombre completo</h2>
                <div class="expanded-status">
                    <span class="status-badge active" id="expanded-status">Disponible</span>
                </div>
            </div>

            <div class="expanded-main">
                <div class="expanded-left">
                    <div class="expanded-image">
                        <img src="/static/imagenes/profile-placeholder.svg" alt="Foto de perfil" id="expanded-avatar">
                        <div class="image-overlay">
                            <span class="view-badge">Perfil</span>
                        </div>
                    </div>

                    <div class="expanded-stats-grid">
                        <div class="stat-item">
                            <span class="fluent--people-team-16-filled"></span>
                            <div class="stat-content">
                                <span class="stat-label">Edad</span>
                                <span class="stat-value" id="expanded-age">--</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="mdi--tools"></span>
                            <div class="stat-content">
                                <span class="stat-label">Rol</span>
                                <span class="stat-value" id="expanded-role">--</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="material-symbols--translate"></span>
                            <div class="stat-content">
                                <span class="stat-label">Idiomas</span>
                                <span class="stat-value" id="expanded-languages">--</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="tabler--clock"></span>
                            <div class="stat-content">
                                <span class="stat-label">Intereses</span>
                                <span class="stat-value" id="expanded-interests-count">--</span>
                            </div>
                        </div>
                    </div>

                    <div class="owner-actions expanded-actions">
                        <button class="ghost-button" id="expanded-reject-button">Rechazar</button>
                        <button class="primary-button" id="expanded-accept-button">Aceptar</button>
                    </div>
                </div>

                <div class="expanded-right">
                    <div class="section">
                        <h3>Bio</h3>
                        <div class="section-content" id="expanded-bio">
                            La persona todavía no cargó una presentación personal.
                        </div>
                    </div>

                    <div class="section">
                        <h3>Habilidades destacadas</h3>
                        <div class="skills-grid" id="expanded-skills"></div>
                    </div>

                    <div class="section">
                        <h3>Intereses</h3>
                        <div class="objectives-list" id="expanded-interests"></div>
                    </div>

                    <div class="section">
                        <h3>Links y contacto</h3>
                        <div class="members-list" id="expanded-links"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/scripts/apiClient.js"></script>
    <script src="/static/scripts/uiCommon.js"></script>
    <script src="/static/scripts/interested.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toast = (message, type = 'info') => {
                if (typeof showToastMessage === 'function') {
                    showToastMessage(message, type);
                } else {
                    console.log(`[${type}] ${message}`);
                }
            };
            const totalEl = document.getElementById('hero-total-interested');
            const availableEl = document.getElementById('hero-available-interested');
            const acceptedEl = document.getElementById('hero-accepted-interested');
            const openProfileBtn = document.getElementById('hero-open-profile');

            if (!totalEl || !availableEl || !acceptedEl) {
                return;
            }

            const renderFromDeck = () => {
                const deck = window.interestedDeck;
                if (!deck) {
                    return;
                }
                const users = Array.isArray(deck.users) ? deck.users : [];
                const total = users.length;
                const available = users.filter(
                    (user) => (user.status || '').toUpperCase() === 'DISPONIBLE',
                ).length;
                const accepted = Number(deck.acceptedCount || 0);
                totalEl.textContent = total;
                availableEl.textContent = available;
                acceptedEl.textContent = accepted;
            };

            const attach = () => {
                const deck = window.interestedDeck;
                if (!deck) {
                    requestAnimationFrame(attach);
                    return;
                }
                if (typeof deck.setSummaryCallback === 'function') {
                    deck.setSummaryCallback((detail) => {
                        if (detail) {
                            totalEl.textContent = detail.total;
                            availableEl.textContent = detail.available;
                            acceptedEl.textContent = detail.accepted;
                        } else {
                            renderFromDeck();
                        }
                    });
                } else if (!deck.__heroSummaryInterval) {
                    deck.__heroSummaryInterval = window.setInterval(renderFromDeck, 1500);
                }
                renderFromDeck();
            };
            attach();

            openProfileBtn?.addEventListener('click', () => {
                const deck = window.interestedDeck;
                if (!deck) {
                    return;
                }
                const current =
                    (typeof deck.getCurrentUser === 'function' && deck.getCurrentUser()) ||
                    deck.users?.[deck.currentIndex] ||
                    null;
                if (!current) {
                    toast('No hay postulaciones para mostrar.', 'aviso');
                    return;
                }
                deck.openExpanded?.();
            });
        });
    </script>
</body>
</html>
